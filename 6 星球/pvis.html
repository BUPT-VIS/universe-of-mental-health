<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.13.1/lodash.js'></script>
  <title>Document</title>
  <style>
    #selectTool {
      position: fixed;
      top: 100px;
      right: 200px;
      /* right: 0;
      bottom: 0; */
      /* margin: 0 auto; */
    }
    #selectState {
      position: fixed;
      top: 160px;
      right: 200px;
    }

    .popupBox {
      background-color: #ffffff;
      box-shadow: 0 0 2px 2px #999;
      padding: 5px;
      position: fixed;
      top: 800px;
      right: 200px;
      width: 800px;
      /* height: 200px; */
    }
    #selectBenefits {
      position: fixed;
      top: 220px;
      right: 200px;
    }

    #selectOptions {
      position: fixed;
      top: 280px;
      right: 200px;
    }

    #selectWellness {
      position: fixed;
      top: 340px;
      right: 200px;
    }

    #selectSeekHelp {
      position: fixed;
      top: 400px;
      right: 200px;
    }

    #selectAnonymity {
      position: fixed;
      top: 460px;
      right: 200px;
    }

    #selectLeave {
      position: fixed;
      top: 520px;
      right: 200px;
    }

    #svgContainer {
      background-color: #000;
      width: 3000px;
    }

    .system {
      display: inline-block;
      position: relative;
      vertical-align: middle;
      width: 50px;
      height: 50px;
    }

    .planet {
      position: absolute;
      top: 0;
      left: 0;
      width: 50px;
      height: 50px;
      -moz-animation-name: rotate;
      -moz-animation-iteration-count: infinite;
      -moz-animation-timing-function: linear;
      -webkit-animation-name: rotate;
      -webkit-animation-iteration-count: infinite;
      -webkit-animation-timing-function: linear;
      animation-name: rotate;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }

   

    @-moz-keyframes rotate {
      from { -moz-transform: rotateZ(0deg); }
      to { -moz-transform: rotateZ(-360deg); }
    }

    @-webkit-keyframes rotate {
      from { -webkit-transform: rotateZ(0deg); }
      to { -webkit-transform: rotateZ(-360deg); }
    }

    @keyframes rotate {
      from { transform: rotateZ(0deg); }
      to { transform: rotateZ(-360deg); }
    }

    .planet-individual {
      position: absolute;
      top: 0;
      left: 0;
      /* width: 50px;
      height: 50px; */
      -moz-animation-name: scale;
      -moz-animation-iteration-count: infinite;
      -moz-animation-timing-function: linear;
      -webkit-animation-name: scale;
      -webkit-animation-iteration-count: infinite;
      -webkit-animation-timing-function: linear;
      animation-name: scale;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }

    @-moz-keyframes scale {
      0% { -moz-transform: scale(0,0); }
      50% { -moz-transform: scale(1,1); }
      100% { -moz-transform: scale(0,0); }
    }

    @-webkit-keyframes scale {
      0% { -webkit-transform: scale(0,0); }
      50% { -webkit-transform: scale(1,1); }
      100% { -webkit-transform: scale(0,0); }
    }

    @keyframes scale {
      0% { transform: scale(0,0); }
      50% { transform: scale(1,1); }
      100% { transform: scale(0,0); }
    }

    .planet-opacity {
      position: absolute;
      top: 0;
      left: 0;
      /* width: 50px;
      height: 50px; */
      -moz-animation-name: opacity;
      -moz-animation-iteration-count: infinite;
      -moz-animation-timing-function: linear;
      -webkit-animation-name: opacity;
      -webkit-animation-iteration-count: infinite;
      -webkit-animation-timing-function: linear;
      animation-name: opacity;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }

    @-moz-keyframes opacity {
      0% { opacity: 0 }
      50% { opacity: 1 }
      100% { opacity: 0 }
    }

    @-webkit-keyframes opacity {
      0% { opacity: 0 }
      50% { opacity: 1 }
      100% { opacity: 0}
    }

    @keyframes opacity {
      0% { opacity: 0 }
      50% { opacity: 1 }
      100% { opacity: 0 }
    }
  </style>
</head>
<body>
    <select name="" id="selectState" onchange="changeOrder(this.id, this.value)">
        <option value="AllCountry">国家</option>
        <option value="WA">WA华盛顿</option>
        <option value="OR">OR俄勒冈</option>
        <option value="ID">ID爱达荷（X）</option>
        <option value="CA">CA加利福尼亚</option>
        <option value="NV">NV内华达（X）</option>
        <option value="UT">UT犹他（X）</option>
        <option value="WY">UY怀俄明（X）</option>
        <option value="CO">CO科罗拉多</option>
        <option value="AZ">AZ亚利桑那</option>
        <option value="SD">SD南达科他（X）</option>
        <option value="NE">NE内布拉斯加（X）</option>
        <option value="KS">KS堪萨斯（X）</option>
        <option value="OK">OK俄克拉荷马（X）</option>
        <option value="NM">NM新墨西哥（X）</option>
        <option value="TX">TX德克萨斯</option>
        <option value="LA">LA路易斯安那（X）</option>
        <option value="MO">MO密苏里</option>
        <option value="IA">IA艾奥瓦（X）</option>
        <option value="MN">MN明尼苏达</option>
        <option value="TN">TN田纳西</option>
        <option value="NY">NY纽约</option>
        <option value="MA">MA马萨诸塞</option>
        <option value="PA">PA宾夕法尼亚</option>
        <option value="FL">FL弗洛里达</option>
      <!-- <option value="Gender">Gender</option>
      <option value="treatment">treatment</option> -->
    </select>
    <div class="totalBox"></div>
    <div id="svgContainer"></div>
    <div class="popupBox"></div>
  <script>
    var dataSet = [];
    var width = 5000
    var height = 9200
    var svg = d3.select('#svgContainer').append('svg').attr('class','svgFlower').attr('width', width).attr('height', height)

        /* 数组分段函数 */
    function sliceArray(array, size) {
      var result = []; //Math.ceil有多余的小数点都取最大整数
        for (var x = 0; x < Math.ceil(array.length / size); x++) {
          var start = x * size;
          var end = start + size;
          result.push(array.slice(start, end));
        }
        return result;
    }

    d3.csv('2016-csv-pre.csv').then(function(rawData) {
      dataSet = rawData
      d3.csv('fork.csv').then(function(posData) {
        draw(dataSet, posData)
      })
      // console.log(dataSet) //有数据
      // let treatment = dataSet.filter(d=>{return d['treatment'] === 'Yes' && d['comments'] !== 'NA'})
      
    })

    function changeOrder(selectId, selectValue) {
      if(selectId === 'selectTool') {
        if(selectValue === 'age') {
          /* 处理数据age排序 */
          var dataSetForAge = JSON.parse(JSON.stringify(dataSet))
          // console.log(dataSetForAge, 'dataSetForAge')
          var dataSetSortByAge = dataSetForAge.sort(function(a, b) { return a.Age - b.Age })
          // var dataSetFilterByAge = dataSetSortByAge.filter(d=>{return d['state'] === 'CA'})
          var dataSetFilterByAge = dataSetSortByAge
          let tempLen = dataSetFilterByAge.length
          // let tempLen = dataSetForAge.length
          d3.select('.totalBox').node().innerHTML = '总数：' + tempLen
          // console.log(dataSet, 'dataSet')
          d3.selectAll('g').remove()
          draw(dataSetFilterByAge)
        }
      } else if(selectId === 'selectState') {
        changeState(selectValue)
      } else if(selectId === 'selectBenefits') {
        changeBenefits(selectValue, 'selectBenefits')
      } else if(selectId === 'selectOptions') {
        changeBenefits(selectValue, 'selectOptions')
      } else if(selectId === 'selectWellness') {
        changeBenefits(selectValue, 'selectWellness')
      } else if(selectId === 'selectSeekHelp') {
        changeBenefits(selectValue, 'selectSeekHelp')
      } else if(selectId === 'selectAnonymity') {
        changeBenefits(selectValue, 'selectAnonymity')
      } else if (selectId === 'selectLeave') {
        changeBenefits(selectValue, 'selectLeave')
      } else if (selectId === 'select_mental_health_consequence') {
        changeBenefits(selectValue, 'select_mental_health_consequence')
      } else if (selectId === 'select_phys_health_consequence') {
        changeBenefits(selectValue, 'select_phys_health_consequence')
      }
    }

    function changeState(state) {
      let dataSetForState = JSON.parse(JSON.stringify(dataSet))
      if (state === 'AllCountry') {
        var dataSetFilterByState = dataSetForState
      } else {
        var dataSetFilterByState = dataSetForState.filter(d=>{return d.state === state})
      }
      // console.log(dataSet, 'dataSet')
      d3.selectAll('g').remove()
      let tempLen = dataSetFilterByState.length
      d3.select('.totalBox').node().innerHTML = '总数：' + tempLen
      draw(dataSetFilterByState)
    }

    function changeBenefits(benefits, type) {
      let dataSetForBenefits = JSON.parse(JSON.stringify(dataSet))
      if (benefits === 'AllBenefits' ) {
        var dataSetFilterByBenefits = dataSetForBenefits
      } else if (type === 'selectBenefits'){
        var dataSetFilterByBenefits = dataSetForBenefits.filter(d=>{return d['benefits'] === benefits})
      } else if(type === 'selectOptions' ) {
        var dataSetFilterByBenefits = dataSetForBenefits.filter(d=>{return d['care_options'] === benefits})
      } else if(type === 'selectWellness' ) {
        var dataSetFilterByBenefits = dataSetForBenefits.filter(d=>{return d['wellness_program'] === benefits})
      } else if(type === 'selectSeekHelp' ) {
        var dataSetFilterByBenefits = dataSetForBenefits.filter(d=>{return d['seek_help'] === benefits})
      } else if(type === 'selectAnonymity' ) {
        var dataSetFilterByBenefits = dataSetForBenefits.filter(d=>{return d['anonymity'] === benefits})
      } else if (type === 'selectLeave') {
        var dataSetFilterByBenefits = dataSetForBenefits.filter(d=>{return  d['leave'] === benefits})
      } else if (type === 'select_mental_health_consequence') {
        var dataSetFilterByBenefits = dataSetForBenefits.filter(d=>{return  d['mental_health_consequence'] === benefits})
      } else if (type === 'select_phys_health_consequence') {
        var dataSetFilterByBenefits = dataSetForBenefits.filter(d=>{return  d['phys_health_consequence'] === benefits})
      }
      // console.log(dataSet, 'dataSet')
      d3.selectAll('g').remove()
      let tempLen = dataSetFilterByBenefits.length
      d3.select('.totalBox').node().innerHTML = '总数：' + tempLen
      draw(dataSetFilterByBenefits)
    }
    
    // console.log(ageList,'ageList')

    function draw(dataSet, posData) {
        /* 开始分隔, 分割后的数据用来直接data()绑定,排序的转折点 */
        var sampleNum = 20
        var len = dataSet.length
        var rowLen = len/sampleNum
        /*求年龄最大值 最小值*/
        var ageList = dataSet.map(function(d) {
          let age = Number(d['What is your age?'])
          if(age > 0 && age < 100) {
            return age
          }
        })

        
        var rowDataSet = sliceArray(dataSet, sampleNum);
        console.log(posData)
        var xList = posData.map(d=>{return d.x})
        var yList = posData.map(d=>{return d.y})
        var xMax = Math.max.apply(null, xList)
        var xMin = Math.min.apply(null, xList)
        var yMax = Math.max.apply(null, yList)
        var yMin = Math.min.apply(null, yList)
        // console.log(yMin, 'yMin')
        var xScale = d3.scaleLinear().domain([xMin, xMax]).range([10,4000])
        var yScale = d3.scaleLinear().domain([yMin, yMax]).range([10,500])
    
        /* 通过循环row数组达到每行绘制的效果 */
        // rowDataSet.forEach((item, i) => {
        // let row = svg.append('g').attr('rowKey', i).attr('transform', function() {
        //   return 'translate(50, '+ (i+1)*100 +')'
        // })
        let g = svg.selectAll('.element').data(dataSet).enter().append('g').attr('class','element')
        .attr('transform', function(d, i) {
          let x = xScale(parseFloat(posData[i]['x']))
          let y = xScale(parseFloat(posData[i]['y']))
          // console.log(y,'y') 
          console.log(d)
          return 'translate(' + x +','+ y +')'
        })
        .on("mouseover", function(d, i) {
          showPopup(d)
          // console.log('000')
        })

        function showPopup(infoElem) {
          let popupBox = document.getElementsByClassName('popupBox')[0]
          let age = infoElem.Age
          let noEmployees = infoElem['no_employees']
          let comment = infoElem['comments']
          popupBox.innerHTML = age + '<br/>' +noEmployees + '<br/>' + comment
          // console.log(infoElem)
          popupBox.style.display = 'block'
        }
        // g.append('rect')
        // .attr('height','35').attr('width','35')
        // .attr('x','0').attr('y','-25')
        // .attr('rx','5').attr('ry','5')
        // .attr("transform", "rotate(45, 0, -25)")
        // .attr('fill','black')

        var sizeScale = d3.scaleLinear().domain([d3.min(ageList), d3.max(ageList)]).range([0, 200]);
        var transformScale = d3.scaleLinear().domain([d3.min(ageList), d3.max(ageList)]).range([.5, 1.8]);

        //十字架
        // fruit.append('path')
        // .attr('d', d3.symbol().type(d3.symbolCross).size(20))
        // .attr('fill',function(d) {
        //   if (d['seek_help'] === 'Yes') {
        //     return 'white'
        //   } else {
        //     return 'transparent'
        //   }
        // })
        //Always start by appending a defs (definitions) element
        var defs = svg.append("defs");

        //Initialize the filter
        defs.append("filter")
            .attr("id", "motionFilter") //Give it a unique ID
            //Increase the width of the filter region to remove blur "boundary"
            .attr("width", "300%")
            //Put center of the "width" back in the middle of the element
            .attr("x", "-100%")
            .append("feGaussianBlur") //Append a filter technique
            .attr("class", "blurValues") //Needed to select later on
            .attr("in", "SourceGraphic") //Apply blur on the applied element
            //Do a blur of 8 standard deviations in the horizontal
            //direction and 0 in vertical
            .attr("stdDeviation", "5 5");
        
  
        let light_radius = 15
        let single_angle = 360/13
        let pos_radius = light_radius - 5
        let opacity_value = .5
            // Detect the appropriate vendor prefix.
        var prefix = "-webkit-transform" in document.body.style ? "-webkit-"
        : "-moz-transform" in document.body.style ? "-moz-"
        : "";
        
        //疾病类型1 : Mood Disorder
         g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*1
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*1
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Mood Disorder')
          if(state !== -1) {
            return '#eb3a4b'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")
        
        

        //疾病类型2 : Anxiety Disorder
        g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*2
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*2
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Anxiety Disorder')
          if(state !== -1) {
            return '#c333f1'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")

        

        //疾病类型3 : Attention Deficit Hyperactivity Disorder
        g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*3
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*3
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Attention Deficit Hyperactivity Disorder')
          if(state !== -1) {
            return '#5d30f5'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")

        //疾病类型4 : Post-traumatic Stress Disorder
        g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*4
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*4
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Post-traumatic Stress Disorder')
          if(state !== -1) {
            return '#425ef5'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")

        //疾病类型5 : Obsessive-Compulsive Disorder
        g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*5
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*5
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Obsessive-Compulsive Disorder')
          if(state !== -1) {
            return '#407bf7'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")

        //疾病类型6 : Substance Use Disorder
        g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*6
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*6
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Substance Use Disorder')
          if(state !== -1) {
            return '#68e2fc'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")


        //疾病类型7 : Personality Disorder 
        g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*7
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*7
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Personality Disorder')
          if(state !== -1) {
            return '#6ee5b9'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")

        //疾病类型8 : Stress Response Syndromes
        g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*8
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*8
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Stress Response Syndromes')
          if(state !== -1) {
            return '#69e282'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")

       //疾病类型9 : Addictive Disorder
       g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*9
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*9
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Addictive Disorder')
          if(state !== -1) {
            return '#9bfb4e'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")
        

      //疾病类型10 : Eating Disorder
       g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*10
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*10
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Eating Disorder')
          if(state !== -1) {
            return '#fcea4f'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")

       //疾病类型11 : Dissociative Disorder
       g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*11
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*11
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Dissociative Disorder')
          if(state !== -1) {
            return '#f19637'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")
        

       //疾病类型12 : Psychotic Disorder
       g.append('circle')
        .attr('r', light_radius)
        .attr('cy', function(d) {
          let angle = single_angle*12
          let light_y = Math.sin(angle)*pos_radius
          return light_y
        })
        .attr('cx', function(d) {
          let angle = single_angle*12
          let light_x = Math.cos(angle)*pos_radius
          return light_x
        })
        .attr('fill',function(d) {
          let str = d['If so, what condition(s) were you diagnosed with?']
          let state = str.indexOf('Psychotic Disorder')
          if(state !== -1) {
            return '#eb4f27'
          } else {
            return 'transparent'
          }
        })
        .attr('fill-opacity', opacity_value)
        .style("filter", "url(#motionFilter)")

        //公司环境：benefits
        g.append('path')
        .attr('d', d3.symbol().type(d3.symbolCircle).size(1000))
        .attr('stroke',function(d) {
          if(d['Does your employer provide mental health benefits as part of healthcare coverage?'] === 'Yes') {
            return '#fff'
          } else {
            return 'transparent'
          }
        })
        .attr('fill', 'transparent')
        .attr('stroke-width', .5)
        .attr("transform", "translate(0, -1)")
        .attr('stroke-dasharray', 1)

        //公司环境：options
        g.append('path')
        .attr('d', d3.symbol().type(d3.symbolCircle).size(1000))
        .attr('stroke',function(d) {
          if(d['Do you know the options for mental health care available under your employer-provided coverage?'] === 'Yes') {
            return '#fff'
          } else {
            return 'transparent'
          }
        })
        .attr('fill', 'transparent')
        .attr('stroke-width', .5)
        .attr("transform", "translate(0, 2)")
        .attr('stroke-dasharray', 1)

         //公司环境：discussion
         g.append('path')
        .attr('d', d3.symbol().type(d3.symbolCircle).size(1000))
        .attr('stroke',function(d) {
          if(d['Has your employer ever formally discussed mental health (for example, as part of a wellness campaign or other official communication)?'] === 'Yes') {
            return '#fff'
          } else {
            return 'transparent'
          }
        })
        .attr('stroke-width', .5)
        .attr('fill', 'transparent')
        .attr("transform", "translate(5, -1)")
        .attr('stroke-dasharray', 1)

        //公司环境：seek_help
        g.append('path')
        .attr('d', d3.symbol().type(d3.symbolCircle).size(1000))
        .attr('stroke',function(d) {
          if(d['Does your employer offer resources to learn more about mental health concerns and options for seeking help?'] === 'Yes') {
            return '#fff'
          } else {
            return 'transparent'
          }
        })
        .attr('fill', 'transparent')
        .attr('stroke-width', .5)
        .attr("transform", "translate(1, -5)")
        .attr('stroke-dasharray', 1)

        // //保护：anonymity
        // g.append('path')
        // .attr('d', d3.symbol().type(d3.symbolCircle).size(800))
        // .attr('stroke','#fff')
        // .attr('fill', 'transparent')
        // .attr('stroke-width', .5)
        // .attr('stroke-dasharray', 1)

        /****  绘制卫星啦  ****/
        let satellite_radius = 20
        let single_satellite_angle = 90/4
        
        //绘制卫星: 雇主+精神+不会负面影响
        g.append('path')
        .attr('d', d3.symbol().type(d3.symbolCircle).size(2))
        .attr('fill',function(d) {
          if(d['Do you think that discussing a mental health disorder with your employer would have negative consequences?'] === 'No') {
            return '#fff'
          } else {
            return 'transparent'
          }
        })
        .attr("transform", function(d) {
          let angle = single_satellite_angle*1
          let satellite_x = Math.cos(angle)*satellite_radius
          let satellite_y = Math.sin(angle)*satellite_radius
          return 'translate('+ satellite_x + ',' + satellite_y +')'
        })

        //绘制卫星: 雇主+身体+不会负面影响
        g.append('path')
        .attr('d', d3.symbol().type(d3.symbolCircle).size(2))
        .attr('fill',function(d) {
          if(d['Do you think that discussing a physical health issue with your employer would have negative consequences?'] === 'No') {
            return '#fff'
          } else {
            return 'transparent'
          }
        })
        .attr("transform", function(d) {
          let angle = single_satellite_angle*2
          let satellite_x = Math.cos(angle)*satellite_radius
          let satellite_y = Math.sin(angle)*satellite_radius
          return 'translate('+ satellite_x + ',' + satellite_y +')'
        })
        //绘制卫星: 同事+精神+愿意
        g.append('path')
        .attr('d', d3.symbol().type(d3.symbolCircle).size(2))
        .attr('fill',function(d) {
          if(d['Would you feel comfortable discussing a mental health disorder with your coworkers?'] === 'Yes') {
            return '#fff'
          } else {
            return 'transparent'
          }
        })
        .attr("transform", function(d) {
          let angle = single_satellite_angle*3
          let satellite_x = Math.cos(angle)*satellite_radius
          let satellite_y = Math.sin(angle)*satellite_radius
          return 'translate('+ satellite_x + ',' + satellite_y +')'
        })

        //绘制卫星: 上司+精神+愿意
        g.append('path')
        .attr('d', d3.symbol().type(d3.symbolCircle).size(2))
        .attr('fill',function(d) {
          if(d['Would you feel comfortable discussing a mental health disorder with your direct supervisor(s)?'] === 'Yes') {
            return '#fff'
          } else {
            return 'transparent'
          }
        })
        .attr("transform", function(d) {
          let angle = single_satellite_angle*4
          let satellite_x = Math.cos(angle)*satellite_radius
          let satellite_y = Math.sin(angle)*satellite_radius
          return 'translate('+ satellite_x + ',' + satellite_y +')'
        })

        

        //绘制菱形
        // g.append('path')
        // .attr('d', d3.symbol().type(d3.symbolDiamond).size(function(d) {
        //   let age = Number(d['What is your age?'])
        //   if(d['What is your gender?'] === 'Male' && age > 0 && age < 100) {
        //     return sizeScale(Number(d['What is your age?']))
        //   } else {
        //     return 0
        //   }
        // }))
        // .attr('fill',function(d) {
        //   if(d['What is your gender?'] === 'Male') {
        //     return '#fff'
        //   }  else {
        //     return 'transparent'
        //   }
        // })
        // .attr('class', 'planet-opacity')
        // .style(prefix + "animation-duration", function(d) {
        //   let question_str = d['Do you think that team members/co-workers would view you more negatively if they knew you suffered from a mental health issue?']
        //   if( question_str === 'Yes, they do') {
        //     return '1s'
        //   } else if (question_str === 'Yes, I think they would') {
        //     return '2s'
        //    }else if (question_str === "Maybe") {
        //     return '3s'
        //    }else if (question_str === "No, I don't think they would") {
        //     return '4s'
        //    }else if (question_str === "No, they do not") {
        //     return '5s'
        //    } else {
        //      return '0s'
        //    }
        // })

        //绘制圆形
        // g.append('path')
        // .attr('d', d3.symbol().type(d3.symbolCircle).size(function(d) {
        //   let age = Number(d['What is your age?'])
        //   if(d['What is your gender?'] === 'Female' && age > 0 && age < 100) {
        //     return sizeScale(Number(d['What is your age?']))
        //   } else {
        //     return 0
        //   }
        // }))
        // .attr('fill',function(d) {
        //   if(d['What is your gender?'] === 'Female') {
        //     return '#fff'
        //   }  else {
        //     return 'transparent'
        //   }
        // })
        

        // //绘制匿名保护
        // g.append('path')
        // .attr('d', d3.symbol().type(d3.symbolCircle).size(function(d) {
        //   let age = Number(d['What is your age?'])
        //   if(d['What is your gender?'] === 'Female' && age > 0 && age < 100 && d['Is your anonymity protected if you choose to take advantage of mental health or substance abuse treatment resources provided by your employer?'] === 'Yes') {
        //     return sizeScale(age+20)
        //   } else {
        //     return 0
        //   }
        // }))
        // .attr('stroke',function(d) {
        //   if(d['What is your gender?'] === 'Female' && d['Is your anonymity protected if you choose to take advantage of mental health or substance abuse treatment resources provided by your employer?'] === 'Yes') {
        //     return '#fff'
        //   }  else {
        //     return 'transparent'
        //   }
        // })
        // .attr('fill','transparent')


    

        //职位映射！
        // g.append('g')
        // .attr('class','system')
        // .append('g')
        // .attr('class', 'planet')
        // .style(prefix + "animation-duration", function(d) {
        //   let jobs =  d['Which of the following best describes your work position?'].split('|')
        //   if(jobs.length === 4) {
        //     return '40s'
        //   } else if(jobs.length === 3) {
        //     return '30s'
        //   } else if(jobs.length === 2) {
        //     return '20s'
        //   } else if(jobs.length === 1) {
        //     return '10s'
        //   } else {
        //     return '0s'
        //   }
        // })
        // .style(prefix + "transform-origin", '0px 0px')
        // .append('circle')
        // .attr('cx', 15)
        // .attr('r', 2)
        // .attr('fill', '#fff')

        // //右边叶子
        // var littleGroup = g.append('g')
        // littleGroup.append("ellipse")
        // .attr("cx", -8)
        // .attr("cy", 20)
        // .attr("rx", 6)
        // .attr("ry", 3)
        // .attr("transform", "rotate(-40)")
        // .attr('fill-opacity', function(d) {
        //   if(d['coworkers'] === 'Some of them' ) {
        //     return .35
        //   } else if (d['coworkers'] === 'No' ) {
        //     return 0
        //   }
        // })
        // //左边叶子
        // littleGroup.append("ellipse")
        // .attr("cx", 8)
        // .attr("cy", 20)
        // .attr("rx", 6)
        // .attr("ry", 3)
        // .attr("transform", "rotate(40)")
        // .attr('fill-opacity', function(d) {
        //   if(d['supervisor'] === 'Some of them' ) {
        //     return .35
        //   } else if (d['coworkers'] === 'No' ) {
        //     return 0
        //   }
        // })

        // //茎
        // g.append('path')
        // .attr('d', function(d) {
        //   if(d['remote_work'] === 'Yes') {
        //     return 'M0,23 Q8,34,-2,50'
        //   } else {
        //     return 'M0,23 Q8,32,0,40'
        //   }
        // })
        // .attr("stroke", "black")
        // .attr("stroke-width", function(d,i) {
        //   if(d['no_employees'] === '1-5') {
        //     return '1px'
        //   } else if(d['no_employees'] === '6-25') {
        //     return '2px'
        //   } else if(d['no_employees'] === '26-100') {
        //     return '3px'
        //   } else if(d['no_employees'] === '100-500') {
        //     return '4px'
        //   } else if(d['no_employees'] === '500-1000') {
        //     return '5px'
        //   } else if(d['no_employees'] === 'More than 1000') {
        //     return '6px'
        //   } else {
        //     return '0'
        //   }
        // })
        // .attr("fill", "transparent")


        g.on('click', function(d) {
          console.log(d,'this')
        })

      // })
    }
      // var g = svg.selectAll('.element').data(dataSet).enter().append('g').attr('class','element')
      // .attr('transform', function(d, i) {
      //   return 'translate(' + i*50 +','+ 10 +')'
      // })


  </script>
  <script src="select.js"></script>
</body>
</html>